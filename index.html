<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Danh sách tệp — albertthai-alt/browse</title>
  <link rel="icon" type="image/png" href="https://cdn-icons-png.freepik.com/256/9517/9517922.png?semt=ais_white_label" />
  <link rel="shortcut icon" type="image/png" href="https://cdn-icons-png.freepik.com/256/9517/9517922.png?semt=ais_white_label" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; margin: 0; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 24px; }
    h1 { margin: 0 0 6px 0; font-size: 1.35rem; }
    .muted { color: #667085; font-size: 0.95rem; margin: 0 0 12px 0; }
    .status { margin: 10px 0; padding: 10px 12px; border-radius: 10px; border: 1px solid #e2e8f0; background: #f8fafc; }
    .error { color: #b42318; }
    ul.files { list-style: none; padding: 0; margin: 10px 0 0 0; display: grid; gap: 10px; }
    .row { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 10px; background: #fff; }
    .row a { color: #1d4ed8; text-decoration: none; }
    .row a:hover { text-decoration: underline; }
    .meta { color: #64748b; font-size: 0.9rem; }
    .kind { font-size: 0.85rem; padding: 2px 6px; border-radius: 999px; border: 1px solid #e2e8f0; margin-right: 8px; }
    .kind.folder { background: #eef2ff; border-color: #c7d2fe; color: #3730a3; }
    .kind.file { background: #f1f5f9; border-color: #e2e8f0; color: #334155; }
    .crumbs { margin: 8px 0 0 0; font-size: 0.95rem; }
    .crumbs a { color: #1d4ed8; text-decoration: none; }
    .crumbs a:hover { text-decoration: underline; }
    @media (prefers-color-scheme: dark) {
      body { background: #0e0f12; color: #eaeef2; }
      .status { border-color: #1f2937; background: #0b0c10; }
      .row { border-color: #1f2937; background: #0b0c10; }
      .muted, .meta { color: #9aa4b2; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Danh sách tệp trong kho</h1>
    <p class="muted">Nguồn: <code>albertthai-alt/browse</code> — duyệt tệp tại thư mục gốc qua GitHub API</p>
    <div id="status" class="status">Đang tải…</div>
    <div id="crumbs" class="crumbs"></div>
    <ul id="files" class="files"></ul>
  </div>

<script>
const owner = 'albertthai-alt';
const repo  = 'browse';
// Current path derived from URL hash (e.g. #quizlet/sub)
function getPathFromHash() {
  const raw = (location.hash || '').replace(/^#/, '');
  const p = decodeURIComponent(raw);
  // normalize to no leading/trailing '/'
  return p.replace(/^\/+|\/+$/g, '');
}

function makeBasePath(path) {
  return './' + (path ? path + '/' : '');
}

function setPath(newPath) {
  const norm = (newPath || '').replace(/^\/+|\/+$/g, '');
  location.hash = encodeURIComponent(norm);
}

function renderCrumbs(path) {
  const el = document.getElementById('crumbs');
  const parts = path ? path.split('/') : [];
  const frag = document.createDocumentFragment();
  const root = document.createElement('a');
  root.href = '#';
  root.textContent = 'Root';
  root.onclick = (e) => { e.preventDefault(); setPath(''); };
  frag.appendChild(root);
  let acc = '';
  parts.forEach((seg, idx) => {
    frag.appendChild(document.createTextNode(' / '));
    acc = acc ? (acc + '/' + seg) : seg;
    const a = document.createElement('a');
    a.href = '#' + encodeURIComponent(acc);
    a.textContent = seg;
    a.onclick = (e) => { e.preventDefault(); setPath(acc); };
    frag.appendChild(a);
  });
  el.innerHTML = '';
  el.appendChild(frag);
}

function formatSize(size) {
  try {
    if (size == null || isNaN(size)) return '';
    if (size < 1024) return size + ' B';
    if (size < 1024*1024) return (size/1024).toFixed(1) + ' KB';
    return (size/(1024*1024)).toFixed(1) + ' MB';
  } catch { return ''; }
}

async function listFiles() {
  const path = getPathFromHash();
  const api = `https://api.github.com/repos/${owner}/${repo}/contents/${path ? encodeURIComponent(path).replace(/%2F/g,'/') : ''}`;
  const statusEl = document.getElementById('status');
  const basePath = makeBasePath(path);
  try {
    const res = await fetch(api, { headers: { 'Accept': 'application/vnd.github.v3+json' }});
    if (!res.ok) {
      if (res.status === 403) {
        throw new Error('Rate limited or API access denied (403). Try again later.');
      }
      throw new Error('HTTP ' + res.status);
    }
    const items = await res.json();

    // Separate dirs and files; exclude index.html
    const dirs = items.filter(i => i.type === 'dir').sort((a,b) => a.name.localeCompare(b.name));
    const files = items.filter(i => i.type === 'file').sort((a,b) => a.name.localeCompare(b.name));

    const ul = document.getElementById('files');
    ul.innerHTML = '';

    renderCrumbs(path);
    if (dirs.length === 0 && files.length === 0) {
      statusEl.textContent = 'Thư mục trống.';
      return;
    }

    // Render directories first
    dirs.forEach(d => {
      const li = document.createElement('li');
      li.className = 'row';

      const left = document.createElement('div');
      const tag = document.createElement('span');
      tag.className = 'kind folder';
      tag.textContent = 'Folder';
      left.appendChild(tag);
      const a = document.createElement('a');
      const nextPath = path ? (path + '/' + d.name) : d.name;
      a.href = '#' + encodeURIComponent(nextPath);
      a.textContent = d.name + '/';
      a.onclick = (e) => { e.preventDefault(); setPath(nextPath); };
      left.appendChild(a);

      const right = document.createElement('div');
      right.className = 'meta';
      const gh = document.createElement('a');
      gh.href = d.html_url;
      gh.textContent = 'GitHub';
      gh.target = '_blank'; gh.rel = 'noopener';
      right.appendChild(gh);

      li.appendChild(left);
      li.appendChild(right);
      ul.appendChild(li);
    });

    // Render files
    files.forEach(f => {
      const li = document.createElement('li');
      li.className = 'row';

      const left = document.createElement('div');
      const tag = document.createElement('span');
      tag.className = 'kind file';
      tag.textContent = 'File';
      left.appendChild(tag);
      const a = document.createElement('a');
      a.href = basePath + encodeURIComponent(f.name).replace(/%2F/g, '/');
      a.textContent = f.name;
      a.target = '_blank';
      a.rel = 'noopener';
      left.appendChild(a);

      const right = document.createElement('div');
      right.className = 'meta';
      const size = formatSize(f.size);
      const gh = document.createElement('a');
      gh.href = f.html_url;
      gh.textContent = 'GitHub';
      gh.target = '_blank';
      gh.rel = 'noopener';
      right.appendChild(document.createTextNode(size ? size + ' · ' : ''));
      right.appendChild(gh);

      li.appendChild(left);
      li.appendChild(right);
      ul.appendChild(li);
    });

    statusEl.textContent = 'Thư mục: ' + (path || '/') + ' — ' + dirs.length + ' thư mục, ' + files.length + ' tệp.';
  } catch (err) {
    console.error(err);
    document.getElementById('status').innerHTML = `<span class="error">Error: ${err.message}</span>`;
    document.getElementById('files').innerHTML = '';
  }
}

window.addEventListener('hashchange', listFiles);
listFiles();
</script>
</body>
</html>
